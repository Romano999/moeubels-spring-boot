-- Extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";


-- Tables
CREATE TABLE IF NOT EXISTS category (
	category_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	category_name TEXT NOT NULL UNIQUE,
	category_description TEXT NOT NULL,
	created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	modified_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS role (
	role_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	role_name TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS actor (
	actor_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	username TEXT NOT NULL,
	password TEXT NOT NULL,
	first_name TEXT NOT NULL,
	last_name TEXT NOT NULL,
	created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	modified_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	role_id UUID NOT NULL,
	FOREIGN KEY(role_id) REFERENCES role(role_id) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS product (
	product_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	price DECIMAL(6,2) NOT NULL,
	product_name TEXT NOT NULL UNIQUE,
	product_description TEXT NOT NULL,
	amount_available INT NOT NULL,
	image_path TEXT,
	is_on_sale BOOLEAN NOT NULL,
	category_id UUID NOT NULL,
	created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	modified_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	FOREIGN KEY(category_id) REFERENCES category(category_id) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS shopping_cart (
	actor_id UUID NOT NULL,
	product_id UUID NOT NULL,
	amount INT NOT NULL,
	added_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	FOREIGN KEY (actor_id) REFERENCES actor(actor_id) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (product_id) REFERENCES product(product_id) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS favourite (
	actor_id UUID NOT NULL,
	product_id UUID NOT NULL,
	added_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	FOREIGN KEY (actor_id) REFERENCES actor(actor_id) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (product_id) REFERENCES product(product_id) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS review (
	review_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	actor_id UUID NOT NULL,
	product_id UUID NOT NULL,
	added_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	FOREIGN KEY (actor_id) REFERENCES actor(actor_id) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (product_id) REFERENCES product(product_id) ON DELETE CASCADE ON UPDATE CASCADE,
	rating INT NOT NULL
);


-- Product categories
INSERT INTO category(category_id, category_name, category_description, created_at, modified_at) VALUES(DEFAULT, 'Chairs', 'A chair is a type of seat for one', DEFAULT, DEFAULT);

INSERT INTO category(category_id, category_name, category_description, created_at, modified_at) VALUES(DEFAULT, 'Couches', 'A piece of furniture for seating multiple people', DEFAULT, DEFAULT);

INSERT INTO category(category_id, category_name, category_description, created_at, modified_at) VALUES(DEFAULT, 'Tables', 'A table is an item of furniture with a flat top and one or more legs, used as a surface for working at, eating from or on which to place things.', DEFAULT, DEFAULT);


-- Products
INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 20.00, 'Deluxe chair', 'Soft Chair', 5, 'https://i.postimg.cc/L8jw2kqz/chair1.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Chairs'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 10.00, 'Simple chair', 'Cheap Chair', 5, 'https://i.postimg.cc/76tQmmcy/chair2.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Chairs'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 30.00, 'Lavish chair', 'Extra lavish chair', 5, 'https://i.postimg.cc/cJSqnkq9/chair3.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Chairs'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 35.00, 'Normal couch', 'Normal couch for 2', 5, 'https://i.postimg.cc/MZrhDp2j/couch1.jpg, false, (SELECT category_id FROM category WHERE category_name = 'Couches'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 50.00, 'Long couch', 'Extra long couch', 5, 'https://i.postimg.cc/c4gP5G0k/couch2.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Couches'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 60.00, 'Fabric couch', 'Couch made out of fabric', 5, 'https://i.postimg.cc/3NWzTPpR/couch3.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Couches'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 15.00, 'Simple round table', 'Normal round table for 2', 5, 'https://i.postimg.cc/zXs6s2fz/table1.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Tables'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 25.00, 'Wooden round table', 'Wooden round table', 5, 'https://i.postimg.cc/wBHPvtJn/table2.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Tables'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, amount_available, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 40.00, 'Marble table', 'Table made out of marble', 5, 'https://i.postimg.cc/vmzK6QtT/table3.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Tables'), DEFAULT, DEFAULT);


-- Roles
INSERT INTO role(role_id, role_name) VALUES (DEFAULT, 'Administrator');

INSERT INTO role(role_id, role_name) VALUES (DEFAULT, 'Actor');


-- Users
INSERT INTO actor(actor_id, username, password, first_name, last_name, created_at, modified_at, role_id) VALUES (DEFAULT, 'JohnDoe', '$2a$12$CAVPMkPAF38riRUdSdilA.sLivTtutP8wMxwr6LyGhZgl1E3PGFvG', 'John', 'Doe', DEFAULT, DEFAULT, (SELECT role_id FROM role WHERE role_name = 'Administrator'));

INSERT INTO actor(actor_id, username, password, first_name, last_name, created_at, modified_at, role_id) VALUES (DEFAULT, 'JaneDoe', '$2a$12$CAVPMkPAF38riRUdSdilA.sLivTtutP8wMxwr6LyGhZgl1E3PGFvG', 'Jane', 'Doe', DEFAULT, DEFAULT, (SELECT role_id FROM role WHERE role_name = 'Actor'));


-- Reviews
INSERT INTO review(review_id, actor_id, product_id, added_at, rating) VALUES (DEFAULT, (SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Simple chair'), DEFAULT, 5);

INSERT INTO review(review_id, actor_id, product_id, added_at, rating) VALUES (DEFAULT, (SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Wooden round table'), DEFAULT, 3);

INSERT INTO review(review_id, actor_id, product_id, added_at, rating) VALUES (DEFAULT, (SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Long couch'), DEFAULT, 4);

INSERT INTO review(review_id, actor_id, product_id, added_at, rating) VALUES (DEFAULT, (SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Fabric couch'), DEFAULT, 2);

INSERT INTO review(review_id, actor_id, product_id, added_at, rating) VALUES (DEFAULT, (SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Deluxe chair'), DEFAULT, 5);


-- Shopping cart
INSERT INTO shopping_cart(actor_id, product_id, amount, added_at) VALUES ((SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Simple chair'), 2, DEFAULT);

INSERT INTO shopping_cart(actor_id, product_id, amount, added_at) VALUES ((SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Long couch'), 3, DEFAULT);


-- Favourites
INSERT INTO favourite(actor_id, product_id, added_at) VALUES ((SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Lavish chair'), DEFAULT);

INSERT INTO favourite(actor_id, product_id, added_at) VALUES ((SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Fabric couch'), DEFAULT);

INSERT INTO favourite(actor_id, product_id, added_at) VALUES ((SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Marble table'), DEFAULT);
