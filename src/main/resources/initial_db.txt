CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

CREATE TABLE IF NOT EXISTS category (
	category_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	category_name TEXT NOT NULL UNIQUE,
	category_description TEXT NOT NULL,
	created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	modified_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE TABLE IF NOT EXISTS actor (
	actor_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	username TEXT NOT NULL,
	password TEXT NOT NULL,
	first_name TEXT NOT NULL,
	last_name TEXT NOT NULL,
	created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	modified_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);


CREATE TABLE IF NOT EXISTS product (
	product_id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
	price DECIMAL(6,2) NOT NULL,
	product_name TEXT NOT NULL UNIQUE,
	product_description TEXT NOT NULL,
	image_path TEXT,
	is_on_sale BOOLEAN NOT NULL,
	category_id UUID NOT NULL,
	created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	modified_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	FOREIGN KEY(category_id) REFERENCES category(category_id) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS shopping_cart (
	actor_id UUID NOT NULL,
	product_id UUID NOT NULL,
	added_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	FOREIGN KEY (actor_id) REFERENCES actor(actor_id) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (product_id) REFERENCES product(product_id) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS favourite (
	actor_id UUID NOT NULL,
	product_id UUID NOT NULL,
	added_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	FOREIGN KEY (actor_id) REFERENCES actor(actor_id) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (product_id) REFERENCES product(product_id) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS review (
	actor_id UUID NOT NULL,
	product_id UUID NOT NULL,
	added_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
	FOREIGN KEY (actor_id) REFERENCES actor(actor_id) ON DELETE CASCADE ON UPDATE CASCADE,
	FOREIGN KEY (product_id) REFERENCES product(product_id) ON DELETE CASCADE ON UPDATE CASCADE,
	rating INT NOT NULL
);


-- Product categories
INSERT INTO category(category_id, category_name, category_description, created_at, modified_at) VALUES(DEFAULT, 'Chairs', 'A chair is a type of seat for one', DEFAULT, DEFAULT);

INSERT INTO category(category_id, category_name, category_description, created_at, modified_at) VALUES(DEFAULT, 'Couches', 'A piece of furniture for seating multiple people', DEFAULT, DEFAULT);

INSERT INTO category(category_id, category_name, category_description, created_at, modified_at) VALUES(DEFAULT, 'Tables', 'A table is an item of furniture with a flat top and one or more legs, used as a surface for working at, eating from or on which to place things.', DEFAULT, DEFAULT);


-- Products
INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 20.00, 'Deluxe chair', 'Soft Chair', 'chairs/chair3.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Chairs'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 10.00, 'Simple chair', 'Cheap Chair', 'chairs/chair2.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Chairs'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 30.00, 'Lavish chair', 'Extra lavish chair', 'chairs/chair3.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Chairs'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 35.00, 'Normal couch', 'Normal couch for 2', 'couches/couch1.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Couches'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 50.00, 'Long couch', 'Extra long couch', 'couches/couch2.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Couches'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 60.00, 'Fabric couch', 'Couch made out of fabric', 'couches/couch3.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Couches'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 15.00, 'Simple round table', 'Normal round table for 2', 'tables/table1.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Tables'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 25.00, 'Wooden round table', 'Wooden round table', 'tables/table2.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Tables'), DEFAULT, DEFAULT);

INSERT INTO product(product_id, price, product_name, product_description, image_path, is_on_sale, category_id, created_at, modified_at) VALUES (DEFAULT, 40.00, 'Marble table', 'Table made out of marble', 'tables/table3.jpg', false, (SELECT category_id FROM category WHERE category_name = 'Tables'), DEFAULT, DEFAULT);


-- User related
INSERT INTO actor(actor_id, username, password, first_name, last_name, created_at, modified_at) VALUES (DEFAULT, 'JohnDoe', '$2a$12$CAVPMkPAF38riRUdSdilA.sLivTtutP8wMxwr6LyGhZgl1E3PGFvG', 'John', 'Doe', DEFAULT, DEFAULT);

INSERT INTO shopping_cart(actor_id, product_id, added_at) VALUES ((SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Simple chair'), DEFAULT);

INSERT INTO favourite(actor_id, product_id, added_at) VALUES ((SELECT actor_id FROM actor WHERE username = 'JohnDoe'), (SELECT product_id FROM product WHERE product_name = 'Fabric couch'), DEFAULT);